import Writable
import os
from FileCreator import FileCreator
from volatileApp.Application import Application


class ScriptWriter(FileCreator):
    _header = '#This script was generated by volatileBash\n' \
              'true'

    def __init__(self, filePath):
        super(ScriptWriter, self).__init__(filePath)
        self.writables = []

    def add(self, writable):
        self.writables.append(writable)

        return self

    def andParalell(self, writable):
        self.writables.append(Writable.ParalellAnd())
        self.writables.append(writable)

        return self

    def getContent(self):
        content = self._header

        for writable in self.writables:
            content += ' & ' + str(writable)

        return content

    def flush(self):
        self._createFile()

        f = open(self.filePath, 'a')
        f.write(self.getContent())
        f.close()

        installerPath = os.path.dirname(self.filePath) + '/installer.sh'
        self._createFile(installerPath)
        f = open(installerPath, 'a')
        for writable in self.writables:
            if isinstance(writable, Application):
                print writable.cmd
                f.write(writable.install() + '\n')

        f.close()

